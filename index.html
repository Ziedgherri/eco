<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Student Help Platform</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:#f4f6fb;
}
header{
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:white;
    padding:15px;
    text-align:center;
    font-size:22px;
    font-weight:bold;
}
.container{
    width:95%;
    max-width:1000px;
    margin:20px auto;
}
.card{
    background:white;
    padding:20px;
    border-radius:15px;
    box-shadow:0 10px 30px rgba(0,0,0,0.1);
    margin-bottom:20px;
}
input,textarea{
    width:100%;
    padding:10px;
    border-radius:10px;
    border:1px solid #ddd;
    margin-bottom:10px;
}
button{
    background:#667eea;
    color:white;
    border:none;
    padding:8px 15px;
    border-radius:8px;
    cursor:pointer;
}
button:hover{opacity:0.9;}
.vote{
    display:flex;
    align-items:center;
    gap:10px;
}
.vote button{
    background:#eee;
    color:black;
}
.username{
    color:#667eea;
    font-weight:bold;
    cursor:pointer;
}
.solution{
    background:#f8f9ff;
    padding:10px;
    border-radius:10px;
    margin-top:10px;
}

/* CHAT */
.chat-box{
    position:fixed;
    bottom:20px;
    right:20px;
    width:330px;
    height:450px;
    background:white;
    border-radius:15px;
    box-shadow:0 10px 30px rgba(0,0,0,0.2);
    display:none;
    flex-direction:column;
}
.chat-header{
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:white;
    padding:10px;
    display:flex;
    justify-content:space-between;
}
.chat-messages{
    flex:1;
    padding:10px;
    overflow-y:auto;
    background:#f4f6fb;
}
.chat-input{
    display:flex;
    padding:10px;
}
.chat-input input{
    flex:1;
}
</style>
</head>
<body>

<header>Student Help Platform</header>

<div class="container">

<div class="card" id="authBox">
<h3>Login / Register</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<input id="username" placeholder="Username (for profile)">
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
</div>

<div id="main" style="display:none;">

<div class="card">
<h3>Post a Problem</h3>
<textarea id="problemText" placeholder="Describe your problem"></textarea>
<input id="problemPrice" placeholder="Reward amount">
<button onclick="addProblem()">Post</button>
</div>

<div id="problems"></div>

</div>
</div>

<div class="chat-box" id="chatBox">
<div class="chat-header">
<span id="chatTitle"></span>
<button onclick="closeChat()">X</button>
</div>
<div class="chat-messages" id="chatMessages"></div>
<div class="chat-input">
<input id="chatInput" placeholder="Write message">
<button onclick="sendMessage()">Send</button>
</div>
</div>

<script>
var firebaseConfig={
apiKey:"YOUR_KEY",
authDomain:"YOUR_DOMAIN",
databaseURL:"YOUR_DB_URL",
projectId:"YOUR_ID"
};
firebase.initializeApp(firebaseConfig);

var auth=firebase.auth();
var db=firebase.database();
var currentUser=null;
var currentChatId=null;

function register(){
auth.createUserWithEmailAndPassword(email.value,password.value)
.then(cred=>{
db.ref("users/"+cred.user.uid).set({
username:username.value,
email:email.value
});
});
}

function login(){
auth.signInWithEmailAndPassword(email.value,password.value);
}

auth.onAuthStateChanged(user=>{
if(user){
currentUser=user;
authBox.style.display="none";
main.style.display="block";
loadProblems();
}
});

function addProblem(){
db.ref("problems").push({
text:problemText.value,
price:problemPrice.value,
userId:currentUser.uid,
votes:0,
timestamp:Date.now()
});
problemText.value="";
problemPrice.value="";
}

function loadProblems(){
db.ref("problems").on("value",snap=>{
problems.innerHTML="";
snap.forEach(child=>{
let p=child.val();
let id=child.key;
db.ref("users/"+p.userId).once("value",u=>{
let uname=u.val()?.username||"User";
problems.innerHTML+=`
<div class="card">
From: <span class="username" onclick="startChat('${p.userId}','${uname}')">${uname}</span><br><br>
${p.text}<br>
Reward: ${p.price}<br><br>

<div class="vote">
<button onclick="voteProblem('${id}',1)">üëç</button>
<span>${p.votes||0}</span>
<button onclick="voteProblem('${id}',-1)">üëé</button>
</div>

<div>
<textarea id="solText${id}" placeholder="Write solution"></textarea>
<button onclick="addSolution('${id}')">Add Solution</button>
</div>

<div id="solutions${id}"></div>

</div>`;
loadSolutions(id);
});
});
});
}

function voteProblem(id,val){
db.ref("problems/"+id+"/votes")
.transaction(v=>(v||0)+val);
}

function addSolution(problemId){
db.ref("problems/"+problemId+"/solutions").push({
text:document.getElementById("solText"+problemId).value,
userId:currentUser.uid,
votes:0
});
}

function loadSolutions(problemId){
db.ref("problems/"+problemId+"/solutions")
.on("value",snap=>{
let div=document.getElementById("solutions"+problemId);
div.innerHTML="";
snap.forEach(child=>{
let s=child.val();
let sid=child.key;
db.ref("users/"+s.userId).once("value",u=>{
let uname=u.val()?.username||"User";
div.innerHTML+=`
<div class="solution">
<span class="username" onclick="startChat('${s.userId}','${uname}')">${uname}</span>: ${s.text}
<div class="vote">
<button onclick="voteSolution('${problemId}','${sid}',1)">üëç</button>
<span>${s.votes||0}</span>
<button onclick="voteSolution('${problemId}','${sid}',-1)">üëé</button>
</div>
</div>`;
});
});
});
}

function voteSolution(pid,sid,val){
db.ref("problems/"+pid+"/solutions/"+sid+"/votes")
.transaction(v=>(v||0)+val);
}

function generateChatId(a,b){
return a<b?a+"_"+b:b+"_"+a;
}

function startChat(otherId,name){
currentChatId=generateChatId(currentUser.uid,otherId);
chatBox.style.display="flex";
chatTitle.innerText="Chat with "+name;

db.ref("chats/"+currentChatId+"/messages")
.on("value",snap=>{
chatMessages.innerHTML="";
snap.forEach(m=>{
let msg=m.val();
let align=msg.sender===currentUser.uid?"right":"left";
chatMessages.innerHTML+=`
<div style="text-align:${align};margin:5px;">
<span style="
background:${align==="right"?"#667eea":"#ddd"};
color:${align==="right"?"white":"black"};
padding:6px 10px;
border-radius:10px;
display:inline-block;">
${msg.text}
</span>
</div>`;
});
chatMessages.scrollTop=chatMessages.scrollHeight;
});
}

function sendMessage(){
if(!chatInput.value)return;
db.ref("chats/"+currentChatId+"/messages").push({
sender:currentUser.uid,
text:chatInput.value,
timestamp:Date.now()
});
chatInput.value="";
}

function closeChat(){
chatBox.style.display="none";
}
</script>

</body>
</html>
