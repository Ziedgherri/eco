<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</title>

<style>
body{font-family:Arial;margin:0;background:#f3f4f6;direction:rtl;}
nav{background:#1e3a8a;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}
button{padding:8px 15px;background:#2563eb;border:none;color:white;cursor:pointer;border-radius:20px;margin-top:5px;}
input, select{width:100%;padding:8px;margin-top:8px;border-radius:10px;border:1px solid #ccc;}
.container{padding:20px;}
.card{padding:15px;margin-top:15px;border-radius:15px;box-shadow:0 4px 8px rgba(0,0,0,0.1);}
.solutionCard{padding:10px;margin-top:8px;border-radius:10px;}
.hidden{display:none;}
</style>
</head>
<body>

<nav>
<h2>Ù…Ù†ØµØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</h2>
<div id="userArea"></div>
</nav>

<div class="container" id="loginPage">
<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<input id="username" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<div class="container hidden" id="mainPage">

<h2>Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø©</h2>
<input id="problemText" placeholder="Ø§ÙƒØªØ¨ Ù…Ø´ÙƒÙ„ØªÙƒ">
<input id="problemPrice" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨">

<select id="problemYear" onchange="updateSections(); updateSubjects()">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø©</option>
<option value="1Ã¨re">1Ã¨re</option>
<option value="2Ã¨me">2Ã¨me</option>
<option value="3Ã¨me">3Ã¨me</option>
<option value="4Ã¨me/Bac">4Ã¨me/Bac</option>
</select>

<select id="problemSection" onchange="updateSubjects()">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>
</select>

<select id="problemSubject">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
</select>

<button onclick="addProblem()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</button>

<h2 style="margin-top:40px;">Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</h2>
<div id="problemsList"></div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase (Ù„Ø§ ØªØºÙŠØ±Ù‡)
const firebaseConfig = {
apiKey: "AIzaSyB4J_b-9NSV_JA678xp8m71nZ2_7I1TKbw",
authDomain: "emeco2.firebaseapp.com",
databaseURL: "https://emeco2-default-rtdb.firebaseio.com/",
projectId: "emeco2",
storageBucket: "emeco2.firebasestorage.app",
messagingSenderId: "961569608008",
appId: "1:961569608008:web:1dc2fa016a1a634e70637d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser = localStorage.getItem("currentUser");

// Ø£Ù„ÙˆØ§Ù† Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
const colors = ["#fef3c7","#fde68a","#fcd34d","#fbbf24","#f97316",
"#fb923c","#f87171","#f472b6","#c084fc","#8b5cf6",
"#60a5fa","#34d399","#86efac"];

function randomColor(){
return colors[Math.floor(Math.random()*colors.length)];
}

// Ø§Ù„Ø´Ø¹Ø¨
const yearSections={
"1Ã¨re":[""],
"2Ã¨me":["Eco","Lettres","Science","Sport","Technique","Info"],
"3Ã¨me":["Eco","Lettres","Science","Sport","Technique","Info"],
"4Ã¨me/Bac":["Eco","Lettres","Science","Sport","Technique","Info"]
};

// Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ø¯ÙˆÙ† Ø®Ù„Ø·
const subjectsBySection={

"1Ã¨re":[
"Math","Arabic","French","English","History","Geography"
],

"2Ã¨me":{
"Eco":["Eco","Gestion","Math","Arabic","French","English","History","Geography"],
"Lettres":["Arabic","French","English","History","Geography"],
"Science":["Math","Physics","Chemistry","Biology","Arabic","French","English"],
"Sport":["Sport","Biology","Arabic","French","English"],
"Technique":["Math","Physics","MÃ©canique","Ã‰lectrique","Arabic","French","English"],
"Info":["Math","Programmation","Algorithmique","Arabic","French","English"]
},

"3Ã¨me":{
"Eco":["Eco","Gestion","Math","Arabic","French","English","Philo","History","Geography","Espagnol","Allemand"],
"Lettres":["Arabic","French","English","Philo","History","Geography","Espagnol","Allemand"],
"Science":["Math","Physics","Chemistry","Biology","Philo","Arabic","French","English"],
"Sport":["Sport","Biology","Arabic","French","English"],
"Technique":["Math","Physics","MÃ©canique","Ã‰lectrique","Philo","Arabic","French","English"],
"Info":["Math","Programmation","Algorithmique","Philo","Arabic","French","English"]
},

"4Ã¨me/Bac":{
"Eco":["Eco","Gestion","Math","Arabic","French","English","Philo","History","Geography","Espagnol","Allemand"],
"Lettres":["Arabic","French","English","Philo","History","Geography","Espagnol","Allemand"],
"Science":["Math","Physics","Chemistry","Biology","Philo","Arabic","French","English"],
"Sport":["Sport","Biology","Arabic","French","English"],
"Technique":["Math","Physics","MÃ©canique","Ã‰lectrique","Philo","Arabic","French","English"],
"Info":["Math","Programmation","Algorithmique","Philo","Arabic","French","English"]
}

};

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¹Ø¨
function updateSections(){
let y=document.getElementById("problemYear").value;
let s=document.getElementById("problemSection");
s.innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>';
if(yearSections[y]){
yearSections[y].forEach(sec=>{
if(sec!=="")
s.innerHTML+=`<option value="${sec}">${sec}</option>`;
});
}
updateSubjects();
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§Ø¯
function updateSubjects(){
let y=document.getElementById("problemYear").value;
let s=document.getElementById("problemSection").value;
let sub=document.getElementById("problemSubject");
sub.innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>';

if(y==="1Ã¨re"){
subjectsBySection["1Ã¨re"].forEach(m=>{
sub.innerHTML+=`<option>${m}</option>`;
});
}else if(subjectsBySection[y] && subjectsBySection[y][s]){
subjectsBySection[y][s].forEach(m=>{
sub.innerHTML+=`<option>${m}</option>`;
});
}
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
function login(){
let name=document.getElementById("username").value.trim();
if(name){
localStorage.setItem("currentUser",name);
currentUser=name;
showPlatform();
}
}

function logout(){
localStorage.removeItem("currentUser");
location.reload();
}

function showPlatform(){
document.getElementById("loginPage").classList.add("hidden");
document.getElementById("mainPage").classList.remove("hidden");
document.getElementById("userArea").innerHTML=
"Ù…Ø±Ø­Ø¨Ø§Ù‹ "+currentUser+" <button onclick='logout()'>Ø®Ø±ÙˆØ¬</button>";
renderProblems();
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø©
function addProblem(){
let text=document.getElementById("problemText").value.trim();
let price=document.getElementById("problemPrice").value.trim();
let year=document.getElementById("problemYear").value;
let section=document.getElementById("problemSection").value;
let subject=document.getElementById("problemSubject").value;

if(text && price && year && section && subject){
let ref=db.ref("problems").push();
ref.set({
user:currentUser,
text,
price,
schoolYear:year,
section,
subject,
timestamp:Date.now()
});
}
}

// Ø¥Ø¶Ø§ÙØ© Ø­Ù„
function addSolution(id){
let sol=document.getElementById("sol"+id).value.trim();
if(sol){
db.ref("problems/"+id+"/solutions").push({
solver:currentUser,
solution:sol
});
}
}

// Ø­Ø°Ù Ù…Ø´ÙƒÙ„Ø© (Admin)
function deleteProblem(id){
if(currentUser && currentUser.toLowerCase()==="jin"){
db.ref("problems/"+id).remove();
}
}

// Ø­Ø°Ù Ø­Ù„ (Admin)
function deleteSolution(pid,sid){
if(currentUser && currentUser.toLowerCase()==="jin"){
db.ref("problems/"+pid+"/solutions/"+sid).remove();
}
}

// Ø¹Ø±Ø¶ Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¬Ù…ÙŠØ¹
function renderProblems(){
db.ref("problems").on("value",snap=>{
let list=document.getElementById("problemsList");
list.innerHTML="";
snap.forEach(p=>{
let data=p.val();
let id=p.key;
let bg=randomColor();

let solutionsHTML="";
if(data.solutions){
Object.entries(data.solutions).forEach(([sid,s])=>{
solutionsHTML+=`
<div class="solutionCard" style="background:${randomColor()}">
<b>${s.solver}</b>: ${s.solution}
${currentUser && currentUser.toLowerCase()==="jin"?
`<button onclick="deleteSolution('${id}','${sid}')">Ø­Ø°Ù</button>`:""}
</div>`;
});
}

list.innerHTML+=`
<div class="card" style="background:${bg}">
<b>${data.user}</b> - ${data.subject}
${currentUser && currentUser.toLowerCase()==="jin"?
`<button onclick="deleteProblem('${id}')">Ø­Ø°Ù</button>`:""}
<br>${data.text}
<br>ğŸ’° ${data.price}
${solutionsHTML}
<input id="sol${id}" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ù„">
<button onclick="addSolution('${id}')">Ø¥Ø±Ø³Ø§Ù„</button>
</div>`;
});
});
}

if(currentUser) showPlatform();

</script>
</body>
</html>
