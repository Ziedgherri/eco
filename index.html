<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ù†ØµØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ° - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©</title>
<style>
body{font-family:Arial;margin:0;background:#f3f4f6;direction:rtl;}
nav{background:#1e3a8a;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}
button{padding:8px 15px;background:#2563eb;border:none;color:white;cursor:pointer;border-radius:20px;margin-top:5px;}
input, select, textarea{width:100%;padding:8px;margin-top:8px;border-radius:10px;border:1px solid #ccc;}
.container{padding:20px;}
.card{padding:15px;margin-top:15px;border-radius:15px;box-shadow:0 4px 8px rgba(0,0,0,0.1);}
.solutionCard{padding:10px;margin-top:8px;border-radius:10px;}
.hidden{display:none;}
.tip{background:#fffbcc;border-left:5px solid #f59e0b;padding:10px;margin:10px 0;}
.filter{margin:10px 0;}
</style>
</head>
<body>

<nav>
<h2>Ù…Ù†ØµØ© Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØªÙ„Ø§Ù…ÙŠØ°</h2>
<div id="userArea"></div>
</nav>

<div class="container" id="loginPage">
<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
<div class="tip">
<b>ØªÙ„Ù…ÙŠØ­Ø§Øª Ù…Ù‡Ù…Ø©:</b> 
<ul>
<li>Ø§Ø³ØªØ®Ø¯Ù… Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„ØªÙ„Ù‚ÙŠ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚.</li>
<li>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ ØªØ®ØªØ§Ø±Ù‡ Ø³ÙŠØ¸Ù„ Ø«Ø§Ø¨ØªÙ‹Ø§ Ù„ÙƒÙ„ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„.</li>
<li>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ Ù„Ù… ØªØµÙ„.</li>
</ul>
</div>
<input id="displayName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨">
<input id="email" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" type="email">
<input id="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" type="password">
<button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
<button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
<button onclick="resendVerification()">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ù‚Ù‚</button>
</div>

<div class="container hidden" id="mainPage">

<h2>Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø©</h2>
<input id="problemText" placeholder="Ø§ÙƒØªØ¨ Ù…Ø´ÙƒÙ„ØªÙƒ">
<input id="problemPrice" placeholder="ÙƒÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø­Ù„ØŸ">

<select id="problemYear" onchange="updateSections(); updateSubjects()">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</option>
<option value="1Ã¨re">1Ã¨re</option>
<option value="2Ã¨me">2Ã¨me</option>
<option value="3Ã¨me">3Ã¨me</option>
<option value="4Ã¨me/Bac">4Ã¨me/Bac</option>
</select>

<select id="problemSection" onchange="updateSubjects()">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>
</select>

<select id="problemSubject">
<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>
</select>

<button onclick="addProblem()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</button>

<h2 style="margin-top:20px;">ÙÙ„ØªØ±Ø© ÙˆØ¨Ø­Ø«</h2>
<div class="filter">
<input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„" oninput="renderProblems()">
<select id="filterYear" onchange="renderProblems()">
<option value="">Ø§Ù„Ø³Ù†Ø© Ø§Ù„ÙƒÙ„</option>
<option value="1Ã¨re">1Ã¨re</option>
<option value="2Ã¨me">2Ã¨me</option>
<option value="3Ã¨me">3Ã¨me</option>
<option value="4Ã¨me/Bac">4Ã¨me/Bac</option>
</select>
<select id="filterSection" onchange="renderProblems()">
<option value="">Ø§Ù„Ø´Ø¹Ø¨Ø© Ø§Ù„ÙƒÙ„</option>
</select>
<select id="filterSubject" onchange="renderProblems()">
<option value="">Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„ÙƒÙ„</option>
</select>
<select id="sortProblems" onchange="renderProblems()">
<option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
<option value="priceHigh">Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù…Ø¨Ù„Øº Ø£ÙˆÙ„Ø§Ù‹</option>
<option value="priceLow">Ø§Ù„Ø£Ù‚Ù„ Ù…Ø¨Ù„Øº Ø£ÙˆÙ„Ø§Ù‹</option>
</select>
</div>

<h2 style="margin-top:20px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§ÙƒÙ„</h2>
<div id="problemsList"></div>

</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script>
// Firebase config
const firebaseConfig = {
apiKey: "AIzaSyB4J_b-9NSV_JA678xp8m71nZ2_7I1TKbw",
authDomain: "emeco2.firebaseapp.com",
databaseURL: "https://emeco2-default-rtdb.firebaseio.com/",
projectId: "emeco2",
storageBucket: "emeco2.firebasestorage.app",
messagingSenderId: "961569608008",
appId: "1:961569608008:web:1dc2fa016a1a634e70637d",
measurementId: "G-12CX368R40"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentUser = null;
const adminEmail = "gherrizied@gmail.com"; // Ø­Ø³Ø§Ø¨ Admin

// Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ§Øª
const cardColors = ["#fef3c7","#fde68a","#fcd34d","#fbbf24","#f59e0b","#f97316","#fb923c","#f87171","#f472b6","#c084fc","#8b5cf6","#60a5fa","#34d399","#86efac"];
function getRandomColor(){return cardColors[Math.floor(Math.random()*cardColors.length)];}

// Ø¯Ø§Ù„Ø© Ø§Ù„ÙˆÙ‚Øª Ù…Ù†Ø° Ø§Ù„Ù†Ø´Ø±
function timeSince(timestamp){
    const now = Date.now();
    const seconds = Math.floor((now - timestamp)/1000);
    if(seconds < 60) return `${seconds} Ø«Ø§Ù†ÙŠØ© Ù…Ø¶Øª`;
    const minutes = Math.floor(seconds/60);
    if(minutes < 60) return `${minutes} Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø¶Øª`;
    const hours = Math.floor(minutes/60);
    if(hours < 24) return `${hours} Ø³Ø§Ø¹Ø© Ù…Ø¶Øª`;
    const days = Math.floor(hours/24);
    if(days < 30) return `${days} ÙŠÙˆÙ… Ù…Ø¶Ù‰`;
    const months = Math.floor(days/30);
    if(months < 12) return `${months} Ø´Ù‡Ø± Ù…Ø¶Ù‰`;
    const years = Math.floor(months/12);
    return `${years} Ø³Ù†Ø© Ù…Ø¶Øª`;
}

// Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø³Ù†Ø© ÙˆØ§Ù„Ø´Ø¹Ø¨Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¯
const yearSections = {
"1Ã¨re":[""],
"2Ã¨me":["Eco","Lettres","Info","Science","Sport"],
"3Ã¨me":["Eco","Lettres","Info","Science","Sport","Technique","Math"],
"4Ã¨me/Bac":["Eco","Lettres","Info","Science","Sport","Technique","Math"]
};
const subjectsBySection = {
"1Ã¨re":["Math","Arabic","French","Physics","Chemistry","History","Geography","Biology","Philosophy","Economics","Sport","Informatics"],
"2Ã¨me":{"Eco":["Math","Arabic","Economics","French","History","Geography","Physics","Chemistry","Biology","Philosophy","Informatics","Sport"],
"Lettres":["Arabic","French","History","Philosophy","Geography","Physics","Chemistry","Biology","Economics","Informatics","Sport"],
"Info":["Math","Informatics","Physics","Arabic","Chemistry","Biology","French","Economics","History","Sport"],
"Science":["Math","Physics","Chemistry","Biology","Arabic","Informatics","French","Economics","History","Sport"],
"Sport":["Sport","Biology","Arabic","Math","Physics","Chemistry","French","Informatics","Economics","History"]
},
"3Ã¨me":{"Eco":["Math","Arabic","Economics","French","History","Geography","Physics","Chemistry","Biology","Philosophy","Informatics","Sport"],
"Lettres":["Arabic","French","History","Philosophy","Geography","Physics","Chemistry","Biology","Economics","Informatics","Sport"],
"Info":["Math","Informatics","Physics","Arabic","Chemistry","Biology","French","Economics","History","Sport"],
"Science":["Math","Physics","Chemistry","Biology","Arabic","Informatics","French","Economics","History","Sport"],
"Sport":["Sport","Biology","Arabic","Math","Physics","Chemistry","French","Informatics","Economics","History"],
"Technique":["Math","Physics","Chemistry","Arabic","Informatics","French","Biology","Economics","History","Geography","Sport"],
"Math":["Math","Physics","Arabic","Chemistry","Biology","French","Informatics","Economics","History","Geography","Sport"]
},
"4Ã¨me/Bac":{"Eco":["Math","Arabic","Economics","French","History","Geography","Physics","Chemistry","Biology","Philosophy","Informatics","Sport"],
"Lettres":["Arabic","French","History","Philosophy","Geography","Physics","Chemistry","Biology","Economics","Informatics","Sport"],
"Info":["Math","Informatics","Physics","Arabic","Chemistry","Biology","French","Economics","History","Sport"],
"Science":["Math","Physics","Chemistry","Biology","Arabic","Informatics","French","Economics","History","Sport"],
"Sport":["Sport","Biology","Arabic","Math","Physics","Chemistry","French","Informatics","Economics","History"],
"Technique":["Math","Physics","Chemistry","Arabic","Informatics","French","Biology","Economics","History","Geography","Sport"],
"Math":["Math","Physics","Arabic","Chemistry","Biology","French","Informatics","Economics","History","Geography","Sport"]
}
};

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø¹Ø¨Ø© ÙˆØ§Ù„Ù…ÙˆØ§Ø¯
function updateSections(){let year=document.getElementById("problemYear").value;let sectionSelect=document.getElementById("problemSection");sectionSelect.innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>';if(year && yearSections[year]){yearSections[year].forEach(sec=>{sectionSelect.innerHTML+=`<option value="${sec}">${sec}</option>`;});} updateSubjects();}
function updateSubjects(){let year=document.getElementById("problemYear").value;let section=document.getElementById("problemSection").value;let subjectSelect=document.getElementById("problemSubject");subjectSelect.innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>';if(year=="1Ã¨re"){subjectsBySection["1Ã¨re"].forEach(sub=>{subjectSelect.innerHTML+=`<option value="${sub}">${sub}</option>`;});}else if(year && section && subjectsBySection[year] && subjectsBySection[year][section]){subjectsBySection[year][section].forEach(sub=>{subjectSelect.innerHTML+=`<option value="${sub}">${sub}</option>`;});}}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
function register() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const displayName = document.getElementById("displayName").value.trim();
    if(email && password && displayName){
        firebase.auth().createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
            const user = userCredential.user;
            db.ref("users/" + user.uid).set({name: displayName,email: user.email});
            user.sendEmailVerification().then(()=>{alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø¨Ù„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ù†ØµØ©.");});
        })
        .catch((error) => { alert(error.message); });
    } else { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); }
}

// Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ù‚Ù‚
function resendVerification() {
    const user = firebase.auth().currentUser;
    if(user){user.sendEmailVerification().then(()=>{alert("ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚.");});} 
    else { alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹"); }
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
function login() {
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    if(email && password){
        firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            const user = userCredential.user;
            if(!user.emailVerified){alert("ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£ÙˆÙ„Ø§Ù‹!");firebase.auth().signOut();return;}
            db.ref("users/" + user.uid).once("value").then(snapshot => {
                const data = snapshot.val();
                currentUser = {email: user.email,name: data.name,isAdmin:(user.email===adminEmail)};
                localStorage.setItem("currentUser", JSON.stringify(currentUser));
                showPlatform();
            });
        })
        .catch((error) => { alert(error.message); });
    } else { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); }
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {firebase.auth().signOut().then(()=>{localStorage.removeItem("currentUser");location.reload();});}

// Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Admin
function isAdmin(){ return currentUser && currentUser.isAdmin; }

// Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø©
function showPlatform(){
    document.getElementById("loginPage").classList.add("hidden");
    document.getElementById("mainPage").classList.remove("hidden");
    document.getElementById("userArea").innerHTML="Ù…Ø±Ø­Ø¨Ø§Ù‹ "+currentUser.name+" <button onclick='logout()'>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>";
    renderProblems();
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙƒÙ„Ø©
function addProblem(){
    let text=document.getElementById("problemText").value.trim();
    let price=document.getElementById("problemPrice").value.trim();
    let year=document.getElementById("problemYear").value;
    let section=document.getElementById("problemSection").value;
    let subject=document.getElementById("problemSubject").value;
    if(text && price && year && section!=null && subject){
        let newRef=db.ref("problems").push();
        newRef.set({user: currentUser.name,text:text,price:price,schoolYear:year,section:section,subject:subject,solutions:{},timestamp:Date.now()})
        .then(()=>{document.getElementById("problemText").value="";document.getElementById("problemPrice").value="";document.getElementById("problemYear").value="";document.getElementById("problemSection").innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø¹Ø¨Ø©</option>';document.getElementById("problemSubject").innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</option>';});
    } else { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); }
}

// Ø¥Ø¶Ø§ÙØ© Ø­Ù„
function addSolution(problemId){
    let solutionText=document.getElementById("solution"+problemId).value.trim();
    let contactText=document.getElementById("contact"+problemId).value.trim();
    let priceText=document.getElementById("price"+problemId).value.trim();
    if(solutionText && contactText && priceText){
        let newSolutionRef=db.ref("problems/"+problemId+"/solutions").push();
        newSolutionRef.set({solver:currentUser.name,solution:solutionText,contact:contactText,price:priceText})
        .then(()=>{ renderProblems(); });
    } else { alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù„"); }
}

// Ø­Ø°Ù Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„
function deleteProblem(id){ if(isAdmin()){ if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©ØŸ")) db.ref("problems/"+id).remove(); } else alert("Ù„ÙŠØ³Øª Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©"); }
function deleteSolution(problemId, solId){ if(isAdmin()){ if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ù„ØŸ")) db.ref("problems/"+problemId+"/solutions/"+solId).remove(); } else alert("Ù„ÙŠØ³Øª Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ©"); }

// ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ù„ÙˆÙ„
function rateSolution(problemId, solId, rate){
    db.ref("problems/"+problemId+"/solutions/"+solId+"/ratings/"+currentUser.name).set(rate);
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ Ù…Ø¹ Ø§Ù„ÙÙ„ØªØ± ÙˆØ§Ù„Ø¨Ø­Ø«
function renderProblems(){
    let list=document.getElementById("problemsList");
    list.innerHTML="";
    let search = document.getElementById("searchInput").value.toLowerCase();
    let filterYear = document.getElementById("filterYear").value;
    let filterSection = document.getElementById("filterSection").value;
    let filterSubject = document.getElementById("filterSubject").value;
    let sortBy = document.getElementById("sortProblems").value;

    db.ref("problems").once("value").then(snapshot=>{
        let problems = [];
        snapshot.forEach(snap=>{problems.push({id:snap.key,...snap.val()});});

        // ÙÙ„ØªØ±Ø© ÙˆØ¨Ø­Ø«
        problems = problems.filter(p=>{
            return (!filterYear || p.schoolYear===filterYear) &&
                   (!filterSection || p.section===filterSection) &&
                   (!filterSubject || p.subject===filterSubject) &&
                   (!search || p.text.toLowerCase().includes(search) || p.user.toLowerCase().includes(search));
        });

        // ÙØ±Ø²
        if(sortBy==="newest"){problems.sort((a,b)=>b.timestamp - a.timestamp);}
        else if(sortBy==="priceHigh"){problems.sort((a,b)=>b.price - a.price);}
        else if(sortBy==="priceLow"){problems.sort((a,b)=>a.price - b.price);}

        problems.forEach(p=>{
            let solutionsHTML="";
            if(p.solutions){Object.entries(p.solutions).forEach(([solId,sol])=>{
                let solutionColor=getRandomColor();
                let ratings = sol.ratings || {};
                let total = Object.values(ratings).reduce((a,b)=>a+b,0);
                let count = Object.values(ratings).length;
                let avg = count?Math.round(total/count):0;
                solutionsHTML+=`<div class="solutionCard" style="background:${solutionColor}">
                <b>Ø§Ù„Ø­Ù„ Ø¨ÙˆØ§Ø³Ø·Ø©:</b> ${sol.solver} 
                ${isAdmin()?`<button onclick="deleteSolution('${p.id}','${solId}')">Ø­Ø°Ù</button>`:""}<br>
                <b>Ø§Ù„Ø­Ù„:</b> ${sol.solution}<br>
                <b>ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„:</b> ${sol.contact}<br>
                <b>Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø­Ù„:</b> ${sol.price}<br>
                <b>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</b> ${avg} / 5 
                <button onclick="rateSolution('${p.id}','${solId}',1)">ğŸ‘</button>
                <button onclick="rateSolution('${p.id}','${solId}',-1)">ğŸ‘</button>
                <br>${timeSince(p.timestamp)}
                </div>`;
            });}
            let cardColor=getRandomColor();
            list.innerHTML+=`<div class="card" style="background:${cardColor}">
            <b>Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù…Ù†:</b> ${p.user} 
            ${isAdmin()?`<button onclick="deleteProblem('${p.id}')">Ø­Ø°Ù</button>`:""}<br>
            <b>Ø§Ù„ÙˆØµÙ:</b> ${p.text}<br>
            <b>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:</b> ${p.price}<br>
            <b>Ø§Ù„Ø³Ù†Ø©:</b> ${p.schoolYear || "-"}<br>
            <b>Ø§Ù„Ø´Ø¹Ø¨Ø©:</b> ${p.section || "-"}<br>
            <b>Ø§Ù„Ù…Ø§Ø¯Ø©:</b> ${p.subject || "-"}<br>
            ${solutionsHTML}
            <input id="solution${p.id}" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø­Ù„">
            <input id="contact${p.id}" placeholder="ÙˆØ³ÙŠÙ„Ø© Ø§Ù„ØªÙˆØ§ØµÙ„">
            <input id="price${p.id}" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø­Ù„">
            <button onclick="addSolution('${p.id}')">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø­Ù„</button>
            <br><small>${timeSince(p.timestamp)}</small>
            </div>`;
        });
    });
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„
let savedUser = localStorage.getItem("currentUser");
if(savedUser){currentUser = JSON.parse(savedUser); showPlatform();}
</script>
</body>
</html>
